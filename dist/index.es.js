import{useRef as e,useState as t,useCallback as r,useEffect as n}from"react";!function(e,t){void 0===t&&(t={});var r=t.insertAt;if(e&&"undefined"!=typeof document){var n=document.head||document.getElementsByTagName("head")[0],c=document.createElement("style");c.type="text/css","top"===r&&n.firstChild?n.insertBefore(c,n.firstChild):n.appendChild(c),c.styleSheet?c.styleSheet.cssText=e:c.appendChild(document.createTextNode(e))}}(".react-taggable-highlight{color:blue}.input{align-items:center;border:1px solid #ccc;border-radius:5px;display:block;min-height:1rem;padding:.4rem;text-align:left;white-space:nowrap;width:100%}@keyframes cursor-blink{0%{opacity:0}}.suggestedTags{display:grid;text-align:left}.suggestedTag{cursor:pointer;padding:8px}.suggestedTag:hover{background:#f2f2f2}.react-taggable-input-tag{background:#333;border-radius:5px;color:#fff;display:inline-block;padding:0 5px}");const c=({elType:e="div",text:t="",__html:r,contentEditable:n=!0,className:c=""})=>{const u=document.createElement(e);return u.className=c,u.innerText=t,r&&(u.innerHTML=r),u.setAttribute("contenteditable",n),u},u=e=>{const t=e.getElementsByTagName("br");for(let e=0;e<t.length;e++)t[e].parentNode.removeChild(t[e])};function s({tags:s,onChange:a,autoFocus:i=!1}){const l=e(),o=e(!1),d=e(null),g=e(),p=e([]),[m,h]=t(!1),[f,y]=t([]),b=s.map((e=>e.triggerSymbol)),v=e([]),x=s.reduce(((e,t)=>(e[t.triggerSymbol]=t.suggestions,e)),{}),T="react-taggable-highlight",k="react-taggable-input-tag",N=e([]),C=r((e=>{p.current.push({symbol:g.current,name:e});const t=l.current.childNodes[l.current.childNodes.length-1],r=c({elType:"span",contentEditable:!1,className:`${k} ${s.find((e=>e.triggerSymbol===g.current)).tagClass}`,text:e});d.current=null,o.current=!1,l.current.removeChild(t),l.current.appendChild(r),l.current.appendChild(document.createTextNode(" ")),h(!1)}),[p,s]);return n((()=>{const e=e=>{if(v.current=[],"Tab"===e.key||" "===e.key||"Enter"===e.key){const t=l.current.childNodes[l.current.childNodes.length-1],r=t.innerText?.replace(g.current,"").toLowerCase()||"";if(1===N.current.length&&o.current||N.current.includes(r)){const e=1===N.current.length?N.current[0]:r;C(e)}else"#text"!==t.nodeName&&t.classList?.contains(T)&&0===N.current.length&&((e=>{const t=e.innerText;l.current.removeChild(e),d.current=null,o.current=!1,h(!1);const r=document.createTextNode(t);l.current.appendChild(r)})(t)," "!==e.key&&l.current.appendChild(document.createTextNode(" ")),e.preventDefault())}if(o.current&&e.key!==g.current){const e=l.current.innerText,t=e.lastIndexOf(g.current),r=e.substr(t+1).replace(/[^\w]/,""),n=new RegExp(r,"i");N.current=x[g.current].filter((e=>n.test(e))),y(N.current)}else a({text:l.current.innerText,__html:l.current.innerHTML,tags:p.current})},t=e=>{if(u(l.current),"Enter"!==e.key&&"Tab"!==e.key||e.preventDefault(),"Backspace"===e.key){const t=l.current.childNodes[l.current.childNodes.length-1],r=l.current.children[l.current.children.length-1];if("Meta"===v.current.slice(-1)[0])return p.current=[],void(l.current.innerHTML="");if(" "===t.nodeValue&&(t.classList?.contains(k)||r.classList?.contains(k)))return p.current.pop(),l.current.removeChild(t),l.current.removeChild(r),void e.preventDefault();(t.classList?.contains(k)||t===d.current&&t.innerText===g.current||"Alt"===v.current.slice(-1)[0]||"Control"===v.current.slice(-1)[0])&&(l.current.removeChild(t),d.current=null,o.current=!1,h(!1),e.preventDefault())}else if(b.includes(e.key)){if(o.current)return void e.preventDefault();g.current=e.key,y(s.find((t=>t.triggerSymbol===e.key)).suggestions),u(l.current),o.current=!0;const t=c({elType:"span",className:`${T} ${s.find((e=>e.triggerSymbol===g.current)).highlightClass}`,contentEditable:!0,text:g.current});l.current.appendChild(t),h(!0),d.current=t,e.preventDefault()}v.current.push(e.key)};return document.addEventListener("keydown",t),document.addEventListener("keyup",e),()=>{document.removeEventListener("keydown",t),document.removeEventListener("keyup",e)}}),[C,s,b,a,x]),n((()=>{if(l.current){i&&l.current.focus();const e={attributes:!0,childList:!0,subtree:!0},t=new MutationObserver((function(e,t){const r=window.getSelection();d.current?(d.current.focus(),r.collapse(d.current,d.current.childNodes.length)):(l.current.focus(),r.collapse(l.current,l.current.childNodes.length))}));return t.observe(l.current,e),()=>t.disconnect()}}),[l,C,i]),React.createElement("div",{className:"taggable"},React.createElement("div",{className:"inputWrapper"},React.createElement("div",{className:"input",ref:l,contentEditable:!0})),m&&React.createElement("div",{className:"suggestedTags"},f.map((e=>React.createElement("div",{onClick:()=>C(e),key:e,className:"suggestedTag"},e)))))}export{s as default};
