import e,{useRef as t,useState as r,useCallback as n,useLayoutEffect as c}from"react";!function(e,t){void 0===t&&(t={});var r=t.insertAt;if(e&&"undefined"!=typeof document){var n=document.head||document.getElementsByTagName("head")[0],c=document.createElement("style");c.type="text/css","top"===r&&n.firstChild?n.insertBefore(c,n.firstChild):n.appendChild(c),c.styleSheet?c.styleSheet.cssText=e:c.appendChild(document.createTextNode(e))}}(".react-taggable-highlight{color:blue}.input{align-items:center;border:1px solid #ccc;border-radius:5px;display:block;min-height:1rem;padding:.4rem;text-align:left;white-space:nowrap;width:100%}.suggestedTags{display:grid;text-align:left}.suggestedTag{cursor:pointer;padding:8px}.suggestedTag:hover{background:#f2f2f2}.react-taggable-input-tag{background:#333;border-radius:5px;color:#fff;display:inline-block;padding:0 5px}");const u=({elType:e="div",text:t="",__html:r,contentEditable:n=!0,className:c=""})=>{const u=document.createElement(e);return u.className=c,u.innerText=t,r&&(u.innerHTML=r),u.setAttribute("contenteditable",n),u},l=e=>{const t=e.getElementsByTagName("br");for(let e=0;e<t.length;e++)t[e].parentNode.removeChild(t[e])};function i({tags:i,onChange:s,autoFocus:a=!1,defaultValue:d,disabled:o=!1}){const g=t(),p=t(!1),h=t(null),m=t(),f=t([]),[y,b]=r(!1),[v,x]=r([]),T=i.map((e=>e.triggerSymbol)),N=t([]),k=i.reduce(((e,t)=>(e[t.triggerSymbol]=t.suggestions,e)),{}),C="react-taggable-highlight",E="react-taggable-input-tag",L=t([]),w=()=>{const e=window.getSelection();h.current?(h.current.focus(),e.collapse(h.current,h.current.childNodes.length)):(g.current.focus(),e.collapse(g.current,g.current.childNodes.length))},S=n((e=>{f.current.push({symbol:m.current,name:e});const t=g.current.childNodes[g.current.childNodes.length-1],r=u({elType:"span",contentEditable:!1,className:`${E} ${i.find((e=>e.triggerSymbol===m.current)).tagClass}`,text:e});h.current=null,p.current=!1,g.current.removeChild(t),g.current.appendChild(r),g.current.appendChild(document.createTextNode(" ")),b(!1)}),[f,i]);return c((()=>{o&&(g.current.setAttribute("contenteditable",!1),g.current.style.opacity=.5)}),[o]),c((()=>{d&&(g.current.innerHTML=d,w())}),[d]),c((()=>{const e=e=>{if(N.current=[],"Tab"===e.key||" "===e.key||"Enter"===e.key){const t=g.current.childNodes[g.current.childNodes.length-1],r=t.innerText?.replace(m.current,"").toLowerCase()||"";if(1===L.current.length&&p.current||L.current.includes(r)){const e=1===L.current.length?L.current[0]:r;S(e)}else"#text"!==t.nodeName&&t.classList?.contains(C)&&0===L.current.length&&((e=>{const t=e.innerText;g.current.removeChild(e),h.current=null,p.current=!1,b(!1);const r=document.createTextNode(t);g.current.appendChild(r)})(t)," "!==e.key&&g.current.appendChild(document.createTextNode(" ")),e.preventDefault())}if(p.current&&e.key!==m.current){const e=g.current.innerText,t=e.lastIndexOf(m.current),r=e.substr(t+1).replace(/[^\w]/,""),n=new RegExp(r,"i");L.current=k[m.current].filter((e=>n.test(e))),x(L.current)}else s({text:g.current.innerText,__html:g.current.innerHTML,tags:f.current})},t=e=>{if(l(g.current),"Enter"!==e.key&&"Tab"!==e.key||e.preventDefault(),"Backspace"===e.key){const t=g.current.childNodes[g.current.childNodes.length-1],r=g.current.children[g.current.children.length-1];if("Meta"===N.current.slice(-1)[0])return f.current=[],void(g.current.innerHTML="");if(" "===t.nodeValue&&(t.classList?.contains(E)||r.classList?.contains(E)))return f.current.pop(),g.current.removeChild(t),g.current.removeChild(r),void e.preventDefault();(t.classList?.contains(E)||t===h.current&&t.innerText===m.current||"Alt"===N.current.slice(-1)[0]||"Control"===N.current.slice(-1)[0])&&(g.current.removeChild(t),h.current=null,p.current=!1,b(!1),e.preventDefault())}else if(T.includes(e.key)){if(p.current)return void e.preventDefault();m.current=e.key,x(i.find((t=>t.triggerSymbol===e.key)).suggestions),l(g.current),p.current=!0;const t=u({elType:"span",className:`${C} ${i.find((e=>e.triggerSymbol===m.current)).highlightClass}`,contentEditable:!0,text:m.current});g.current.appendChild(t),b(!0),h.current=t,e.preventDefault()}N.current.push(e.key)};return document.addEventListener("keydown",t),document.addEventListener("keyup",e),()=>{document.removeEventListener("keydown",t),document.removeEventListener("keyup",e)}}),[S,i,T,s,k]),c((()=>{if(g.current){a&&g.current.focus();const e={attributes:!0,childList:!0,subtree:!0},t=new MutationObserver((function(e,t){w()}));return t.observe(g.current,e),()=>t.disconnect()}}),[g,S,a]),e.createElement("div",{className:"taggable"},e.createElement("div",{className:"inputWrapper"},e.createElement("div",{className:"input",ref:g,contentEditable:!0})),y&&e.createElement("div",{className:"suggestedTags"},v.map((t=>e.createElement("div",{onClick:()=>S(t),key:t,className:"suggestedTag"},t)))))}export{i as default};
