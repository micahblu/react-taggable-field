"use strict";var e=require("react");function t(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var r=t(e);!function(e,t){void 0===t&&(t={});var r=t.insertAt;if(e&&"undefined"!=typeof document){var n=document.head||document.getElementsByTagName("head")[0],c=document.createElement("style");c.type="text/css","top"===r&&n.firstChild?n.insertBefore(c,n.firstChild):n.appendChild(c),c.styleSheet?c.styleSheet.cssText=e:c.appendChild(document.createTextNode(e))}}(".react-taggable-highlight{color:blue}.input{align-items:center;border:1px solid #ccc;border-radius:5px;display:block;min-height:1rem;padding:.4rem;text-align:left;white-space:nowrap;width:100%}.suggestedTags{display:grid;text-align:left}.suggestedTag{cursor:pointer;padding:8px}.suggestedTag:hover{background:#f2f2f2}.react-taggable-input-tag{background:#333;border-radius:5px;color:#fff;display:inline-block;padding:0 5px}");const n=({elType:e="div",text:t="",__html:r,contentEditable:n=!0,className:c=""})=>{const u=document.createElement(e);return u.className=c,u.innerText=t,r&&(u.innerHTML=r),u.setAttribute("contenteditable",n),u},c=e=>{const t=e.getElementsByTagName("br");for(let e=0;e<t.length;e++)t[e].parentNode.removeChild(t[e])};module.exports=function({tags:t,onChange:u,autoFocus:s=!1,defaultValue:a,disabled:l=!1}){const i=e.useRef(),d=e.useRef(!1),o=e.useRef(null),g=e.useRef(),f=e.useRef([]),[p,h]=e.useState(!1),[m,y]=e.useState([]),b=t.map((e=>e.triggerSymbol)),v=e.useRef([]),x=t.reduce(((e,t)=>(e[t.triggerSymbol]=t.suggestions,e)),{}),T="react-taggable-highlight",N="react-taggable-input-tag",k=e.useRef([]),E=()=>{const e=window.getSelection();o.current?(o.current.focus(),e.collapse(o.current,o.current.childNodes.length)):(i.current.focus(),e.collapse(i.current,i.current.childNodes.length))},C=e.useCallback((e=>{f.current.push({symbol:g.current,name:e});const r=i.current.childNodes[i.current.childNodes.length-1],c=n({elType:"span",contentEditable:!1,className:`${N} ${t.find((e=>e.triggerSymbol===g.current)).tagClass}`,text:e});o.current=null,d.current=!1,i.current.removeChild(r),i.current.appendChild(c),i.current.appendChild(document.createTextNode(" ")),h(!1)}),[f,t]);return e.useLayoutEffect((()=>{l&&(i.current.setAttribute("contenteditable",!1),i.current.style.opacity=.5)}),[l]),e.useLayoutEffect((()=>{a&&(i.current.innerHTML=a,E())}),[a]),e.useLayoutEffect((()=>{const e=e=>{if(v.current=[],"Tab"===e.key||" "===e.key||"Enter"===e.key){const t=i.current.childNodes[i.current.childNodes.length-1],r=t.innerText?.replace(g.current,"").toLowerCase()||"";if(1===k.current.length&&d.current||k.current.includes(r)){const e=1===k.current.length?k.current[0]:r;C(e)}else"#text"!==t.nodeName&&t.classList?.contains(T)&&0===k.current.length&&((e=>{const t=e.innerText;i.current.removeChild(e),o.current=null,d.current=!1,h(!1);const r=document.createTextNode(t);i.current.appendChild(r)})(t)," "!==e.key&&i.current.appendChild(document.createTextNode(" ")),e.preventDefault())}if(d.current&&e.key!==g.current){const e=i.current.innerText,t=e.lastIndexOf(g.current),r=e.substr(t+1).replace(/[^\w]/,""),n=new RegExp(r,"i");k.current=x[g.current].filter((e=>n.test(e))),y(k.current)}else u({text:i.current.innerText,__html:i.current.innerHTML,tags:f.current})},r=e=>{if(c(i.current),"Enter"!==e.key&&"Tab"!==e.key||e.preventDefault(),"Backspace"===e.key){const t=i.current.childNodes[i.current.childNodes.length-1],r=i.current.children[i.current.children.length-1];if("Meta"===v.current.slice(-1)[0])return f.current=[],void(i.current.innerHTML="");if(" "===t.nodeValue&&(t.classList?.contains(N)||r.classList?.contains(N)))return f.current.pop(),i.current.removeChild(t),i.current.removeChild(r),void e.preventDefault();(t.classList?.contains(N)||t===o.current&&t.innerText===g.current||"Alt"===v.current.slice(-1)[0]||"Control"===v.current.slice(-1)[0])&&(i.current.removeChild(t),o.current=null,d.current=!1,h(!1),e.preventDefault())}else if(b.includes(e.key)){if(d.current)return void e.preventDefault();g.current=e.key,y(t.find((t=>t.triggerSymbol===e.key)).suggestions),c(i.current),d.current=!0;const r=n({elType:"span",className:`${T} ${t.find((e=>e.triggerSymbol===g.current)).highlightClass}`,contentEditable:!0,text:g.current});i.current.appendChild(r),h(!0),o.current=r,e.preventDefault()}v.current.push(e.key)};return document.addEventListener("keydown",r),document.addEventListener("keyup",e),()=>{document.removeEventListener("keydown",r),document.removeEventListener("keyup",e)}}),[C,t,b,u,x]),e.useLayoutEffect((()=>{if(i.current){s&&i.current.focus();const e={attributes:!0,childList:!0,subtree:!0},t=new MutationObserver((function(e,t){E()}));return t.observe(i.current,e),()=>t.disconnect()}}),[i,C,s]),r.default.createElement("div",{className:"taggable"},r.default.createElement("div",{className:"inputWrapper"},r.default.createElement("div",{className:"input",ref:i,contentEditable:!0})),p&&r.default.createElement("div",{className:"suggestedTags"},m.map((e=>r.default.createElement("div",{onClick:()=>C(e),key:e,className:"suggestedTag"},e)))))};
