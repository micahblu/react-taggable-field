"use strict";var e=require("react");!function(e,t){void 0===t&&(t={});var r=t.insertAt;if(e&&"undefined"!=typeof document){var n=document.head||document.getElementsByTagName("head")[0],c=document.createElement("style");c.type="text/css","top"===r&&n.firstChild?n.insertBefore(c,n.firstChild):n.appendChild(c),c.styleSheet?c.styleSheet.cssText=e:c.appendChild(document.createTextNode(e))}}(".react-taggable-highlight{color:blue}.input{align-items:center;border:1px solid #ccc;border-radius:5px;display:block;min-height:1rem;padding:.4rem;text-align:left;white-space:nowrap;width:100%}@keyframes cursor-blink{0%{opacity:0}}.suggestedTags{display:grid;text-align:left}.suggestedTag{cursor:pointer;padding:8px}.suggestedTag:hover{background:#f2f2f2}.react-taggable-input-tag{background:#333;border-radius:5px;color:#fff;display:inline-block;padding:0 5px}");const t=({elType:e="div",text:t="",__html:r,contentEditable:n=!0,className:c=""})=>{const u=document.createElement(e);return u.className=c,u.innerText=t,r&&(u.innerHTML=r),u.setAttribute("contenteditable",n),u},r=e=>{const t=e.getElementsByTagName("br");for(let e=0;e<t.length;e++)t[e].parentNode.removeChild(t[e])};module.exports=function({tags:n,onChange:c,autoFocus:u=!1}){const s=e.useRef(),a=e.useRef(!1),l=e.useRef(null),i=e.useRef(),d=e.useRef([]),[o,g]=e.useState(!1),[p,h]=e.useState([]),m=n.map((e=>e.triggerSymbol)),f=e.useRef([]),y=n.reduce(((e,t)=>(e[t.triggerSymbol]=t.suggestions,e)),{}),b="react-taggable-highlight",v="react-taggable-input-tag",x=e.useRef([]),k=e.useCallback((e=>{d.current.push({symbol:i.current,name:e});const r=s.current.childNodes[s.current.childNodes.length-1],c=t({elType:"span",contentEditable:!1,className:`${v} ${n.find((e=>e.triggerSymbol===i.current)).tagClass}`,text:e});l.current=null,a.current=!1,s.current.removeChild(r),s.current.appendChild(c),s.current.appendChild(document.createTextNode(" ")),g(!1)}),[d,n]);return e.useEffect((()=>{const e=e=>{if(f.current=[],"Tab"===e.key||" "===e.key||"Enter"===e.key){const t=s.current.childNodes[s.current.childNodes.length-1],r=t.innerText?.replace(i.current,"").toLowerCase()||"";if(1===x.current.length&&a.current||x.current.includes(r)){const e=1===x.current.length?x.current[0]:r;k(e)}else"#text"!==t.nodeName&&t.classList?.contains(b)&&0===x.current.length&&((e=>{const t=e.innerText;s.current.removeChild(e),l.current=null,a.current=!1,g(!1);const r=document.createTextNode(t);s.current.appendChild(r)})(t)," "!==e.key&&s.current.appendChild(document.createTextNode(" ")),e.preventDefault())}if(a.current&&e.key!==i.current){const e=s.current.innerText,t=e.lastIndexOf(i.current),r=e.substr(t+1).replace(/[^\w]/,""),n=new RegExp(r,"i");x.current=y[i.current].filter((e=>n.test(e))),h(x.current)}else c({text:s.current.innerText,__html:s.current.innerHTML,tags:d.current})},u=e=>{if(r(s.current),"Enter"!==e.key&&"Tab"!==e.key||e.preventDefault(),"Backspace"===e.key){const t=s.current.childNodes[s.current.childNodes.length-1],r=s.current.children[s.current.children.length-1];if("Meta"===f.current.slice(-1)[0])return d.current=[],void(s.current.innerHTML="");if(" "===t.nodeValue&&(t.classList?.contains(v)||r.classList?.contains(v)))return d.current.pop(),s.current.removeChild(t),s.current.removeChild(r),void e.preventDefault();(t.classList?.contains(v)||t===l.current&&t.innerText===i.current||"Alt"===f.current.slice(-1)[0]||"Control"===f.current.slice(-1)[0])&&(s.current.removeChild(t),l.current=null,a.current=!1,g(!1),e.preventDefault())}else if(m.includes(e.key)){if(a.current)return void e.preventDefault();i.current=e.key,h(n.find((t=>t.triggerSymbol===e.key)).suggestions),r(s.current),a.current=!0;const c=t({elType:"span",className:`${b} ${n.find((e=>e.triggerSymbol===i.current)).highlightClass}`,contentEditable:!0,text:i.current});s.current.appendChild(c),g(!0),l.current=c,e.preventDefault()}f.current.push(e.key)};return document.addEventListener("keydown",u),document.addEventListener("keyup",e),()=>{document.removeEventListener("keydown",u),document.removeEventListener("keyup",e)}}),[k,n,m,c,y]),e.useEffect((()=>{if(s.current){u&&s.current.focus();const e={attributes:!0,childList:!0,subtree:!0},t=new MutationObserver((function(e,t){const r=window.getSelection();l.current?(l.current.focus(),r.collapse(l.current,l.current.childNodes.length)):(s.current.focus(),r.collapse(s.current,s.current.childNodes.length))}));return t.observe(s.current,e),()=>t.disconnect()}}),[s,k,u]),React.createElement("div",{className:"taggable"},React.createElement("div",{className:"inputWrapper"},React.createElement("div",{className:"input",ref:s,contentEditable:!0})),o&&React.createElement("div",{className:"suggestedTags"},p.map((e=>React.createElement("div",{onClick:()=>k(e),key:e,className:"suggestedTag"},e)))))};
